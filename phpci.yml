build_settings:
    verbose: true
  
setup:
    composer:
        action: install
    shell:
        - mkdir -p build/logs
        
test:
    php_unit:
        coverage: build/logs
    php_mess_detector:
        rules:
            - "cleancode"
            - "controversial"
            - "codesize"
            - "design"
            - "naming"
            - "unusedcode"
            - "somedir/customruleset.xml"
        allow_failures: true
        zero_config: true # do not make build as failed if something was detected
    php_cs_fixer:
        verbose: true
        diff: true
        level: "psr2"
        
complete:
    shell:
        - rm -rf /var/www/html/transactpro-integration-php/branches/%BRANCH%/
        - mkdir -p /var/www/html/transactpro-integration-php/branches/%BRANCH%/
        - cp -r ./* /var/www/html/transactpro-integration-php/branches/%BRANCH%/
        - chmod -R 777 /var/www/html/transactpro-integration-php/branches/%BRANCH%/
        - chmod -R ugo+s /var/www/html/transactpro-integration-php/branches/%BRANCH%/
        - setfacl -dRm u::rwX,g::rwX,o::rwX /var/www/html/transactpro-integration-php/branches/%BRANCH%/
        - echo "Branch build is available at /var/www/html/transactpro-integration-php/branches/%BRANCH%"
        - echo "Web access: http://%BRANCH%.transactpro-integration-php.pub/"
        - echo "Build clover: http://%BRANCH%.transactpro-integration-php.pub/build/logs/index.html"
